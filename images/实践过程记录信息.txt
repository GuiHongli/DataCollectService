Cursor实践过程记录。

数据库信息
Root    ghl12306Happy@
CREATE DATABASE IF NOT EXISTS `data_collect` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mbCREATE DATABASE IF NOT EXISTS `data_collect` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb

CREATE DATABASE ‘data_collect’

一、准备
1、githubi对接
2、将项目前后端拖到cursor相同workspace中

二、实践
1、指定前后端框架及模块


对话1：
开发一个项目，用于配置管理数据采集任务。涉及两个服务。
前端项目DataCollectFront和后端项目DataCollectService。

DataCollectFront前端使用vue框架开发，
DataCollectService后台服务使用java语言，SpringBoot+Mybatis+mysql 5.7开发

涉及以下模块，管理模块均涉及增删改查，均需记录创建人、修改人、创建时间、修改时间等变更内容
1、地域管理模块
- 片区、国家、省份、城市子模块
各模块之间有联动关系。
示例：中国China-中国China-辽宁省LN-沈阳SY

2、网络类型管理模块
网络类型分为四种：normal、弱网、拥塞、弱网+用撒

3、执行机管理模块
 基础信息：执行机IP 执行机所属地域（片区、国家、省份、城市）描述
4、UE管理模块
UE基础信息：ueid，用途，网络类型信息
5、逻辑环境管理模块：对执行机和UE的使用组合
逻辑环境基础信息：逻辑环境名称
一个逻辑环境，包含一个执行机、多个UE
6、用例集管理模块
用例集关键信息：用例集名称、用例集版本、用例集zip,创建人、创建时间
用例集名称和版本需要从上传的用例集zip命名中提取。zip命名规则为
用例集名称_用例集版本.zip
示例 短视频采集_v0.1.zip

7、采集策略管理模块
基本信息：策略名称、采集次数、逻辑组网（页面选择）
基于采集策略，可创建采集任务


8、采集任务管理模块
采集任务的增删改查

对话2：
前端调整菜单成下述排列：
仪表盘
数据采集
- 采集任务管理
- 采集策略管理
设置
- 用例集管理
- 逻辑环境管理
- 执行机管理
- UE管理
- 地域管理
- 网络类型管理

对话3：
逻辑环境管理模块：一个逻辑环境对于一个执行机和多个UE。在新增逻辑环境时，需要同时选择多个UE，选择UE时，需要能看到ueid及用途

对话4：
网络类型管理：不需要网络类型代码信息
地域管理：不需要地域代码信息
前后端一起修改

对话5：
UE管理菜单手机图标，显示不出来

对话6：
地域管理：仅有两个按钮
一个按钮 单独新增地域和国家，区域必填，国家可选，已录入的地域支持录入时下拉选择
一个按钮 录入国家-省份-城市，国家必填，省份、城市可选。已录入的国家、省份支持录入时下拉选择

地域管理：
一次录入即可同时录入 地域、国家、省份、城市。
已经录入的地域、国家、省份信息，可用于下次录入是下拉选择。

地域信息纯手工填写，国家、省份、城市 基于地理同事，支持搜索选择
已经录入的地域，可用于下次录入选择。
同时修改前后端

对话
地域管理：按照地域-国家-省份-城市 关联显示。对于的后台代码、表结构、表数据需要重新审视下

录入信息时，下拉可选内容需要动态变化，如国家选择了中国，省份下拉时仅有属于中国的省份

对话：
UE管理：页面网络类型信息展示不出来

对话：
执行机管理：
1、新增执行机时，选择所属地域时，下拉选择时呈现地域管理中录入的地域+国家+省份+城市，支持基于文本模糊搜索
2、页面呈现数据时，所示地域，需要呈现地域+国家+省份+城市信息

逻辑环境管理：
1、新增逻辑环境时，选择执行机时，需要展示执行机名称+ip+所属地域
2、新增逻辑环境时，选择ue时，需要展示UE名称+ueid+用途


对话：

用例集管理：上传的zip文件内容如下，
包含1个文件夹和1个文件，1个文件夹是 scripts 1个文件是case.xlsx
Case.xlsx包含6列：用例_名称 用例_编号 用例_逻辑组网 用例_测试步骤 用例_预期结果

后台实现，需要将zip上传到本地,并对zip进行解压，解析Case.xlsx内容，将解析到的Case数据存入数据库表中

scripts中放一个简易的python脚本


用例集管理页面，点击用例集名称，可以新切换一个页面，用于呈现用例集中包含的用例信息


采集任务管理：
1）基本信息：输入采集任务名称
2）采集策略：下拉选择采集策略
3）环境编排：支持基于环境已有的信息做过来筛选，地域、国家、省份、城市


创建采集任务页面，用户选完采集策略 和 环境编排筛选条件后，页面下面需要展示可以使用的逻辑环境列表。

逻辑环境列表匹配逻辑为：
1）解析采集策略中关联用例集的测试用例，提取出涉及的多个环境组网列表，命名为环境组网列表A
2）基于环境编排中选择的筛选条件，获得到一批可用的执行机，再获取到执行机关联的一批逻辑环境，命名为逻辑环境列表B
3）筛选逻辑环境列表B，针对每一个逻辑环境，其对应的多个环境组网，只要存在于环境组网列表A中，则认为该逻辑环境可用






CaseExecuteService服务中增加一个post接口，用于接收用例执行任务。
包括字段 用例执行任务Id  执行机Ip  用例集id 用例集存储路径 用例列表 结果上报url  日志上报url

接口内部实现：
1、用例集存储路径是gohttpserver的一个路径，例如：http://localhost:8000/upload/网络测试用例集_v1.0_1755243337673.zip。使用get请求，请求用例集存储路径，把用例集zip下载到本地
2、解压用例集zip到一个临时目录A
3、循环用例列表中的每一个用例
- 拿到用例Id，在目录A/cases目录查找用例Id.py
- 运行 python命令，执行用例Id.py，需要记录用例执行耗时，需并将用例的执行日志记录到一个log文件中
- 需要基于控制台输出判断用例的执行结果
- 调用结果上报url上报用例执行结果，结果上报url是DataCollectService暴露的一个post接口，用于接收用例执行结果
- 调用日志上报url上报用例执行日志，日志上报url是gohttpserver直接暴露出来的一个目录路径，例如：http://localhost:8000/upload/log

DataCollectFront,创建采集任务后。后台需要做以下处理
1）记录采集任务本身的信息
2）组装用例：将采集策略中关联用例集的测试用例，按照采集次数循环多次，形成用例执行例次列表
3）记录可用的逻辑环境
4）将用例执行例次列表，均分到可用的逻辑环境上
5）针对每个逻辑环境，获取其关联的执行机的执行机ip,调用执行机ip上启动的CaseExecuteService的任务接收接口
6）新建记录表，用于记录 采集任务中，某个用例例次在某个逻辑环境、某个执行机上的执行进度及执行结果



1)将用例执行例次列表，均分到可用的逻辑环境上。
例如有10个用例，有2套可用的逻辑环境，需要均分成为 逻辑环境1-5个用例  逻辑环境2-5个用例
2)针对每一个逻辑环境，获取其对应的执行机Ip，调用执行机ip上启动的CaseExecuteService的任务接收接口













逻辑环境管理页面，更改逻辑组网不生效


